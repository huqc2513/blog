<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue中的extend | blog</title>
    <meta name="description" content="个人博客">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.e78083b5.css" as="style"><link rel="preload" href="/blog/assets/js/app.1a49a42b.js" as="script"><link rel="preload" href="/blog/assets/js/12.15a468c8.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.a07290b9.js"><link rel="prefetch" href="/blog/assets/js/11.156c8779.js"><link rel="prefetch" href="/blog/assets/js/13.17b5b984.js"><link rel="prefetch" href="/blog/assets/js/14.35f506b9.js"><link rel="prefetch" href="/blog/assets/js/2.4a4c90f0.js"><link rel="prefetch" href="/blog/assets/js/3.2fa98668.js"><link rel="prefetch" href="/blog/assets/js/4.2495dabf.js"><link rel="prefetch" href="/blog/assets/js/5.9886d6cb.js"><link rel="prefetch" href="/blog/assets/js/6.fce2a709.js"><link rel="prefetch" href="/blog/assets/js/7.610ed205.js"><link rel="prefetch" href="/blog/assets/js/8.b57f2989.js"><link rel="prefetch" href="/blog/assets/js/9.e548a89b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.e78083b5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/vue/emitter/vue组件之间的多种通信方式.html" class="nav-link">vue</a></div><div class="nav-item"><a href="/blog/react/手写一个react路由.html" class="nav-link">react</a></div> <a href="https://github.com/huqc2513" target="_blank" rel="noopener noreferrer" class="repo-link">
    github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/vue/emitter/vue组件之间的多种通信方式.html" class="nav-link">vue</a></div><div class="nav-item"><a href="/blog/react/手写一个react路由.html" class="nav-link">react</a></div> <a href="https://github.com/huqc2513" target="_blank" rel="noopener noreferrer" class="repo-link">
    github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>node</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>vue</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/blog/vue/vue组件之间的多种通信方式.html" class="sidebar-link">vue组件的多种通信方式</a></li><li><a href="/blog/vue/datePicker/" class="sidebar-link">dataPicker实现(日期选择组件)</a></li><li><a href="/blog/vue/notification/" class="active sidebar-link">vue中的extend</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/vue/notification/#目录结构" class="sidebar-link">目录结构</a></li><li class="sidebar-sub-header"><a href="/blog/vue/notification/#func-notification-js-单独实现业务" class="sidebar-link">func-notification.js (单独实现业务)</a></li><li class="sidebar-sub-header"><a href="/blog/vue/notification/#function-js-管理实例" class="sidebar-link">function.js (管理实例)</a></li><li class="sidebar-sub-header"><a href="/blog/vue/notification/#index-js-该模块的接口文件" class="sidebar-link">index.js(该模块的接口文件)</a></li><li class="sidebar-sub-header"><a href="/blog/vue/notification/#使用" class="sidebar-link">使用</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>javascript</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="vue中的extend"><a href="#vue中的extend" aria-hidden="true" class="header-anchor">#</a> vue中的extend</h1> <p>平时我们写vue组件都是template形式，然后Import导入注册来使用，其实vue创建组件的方式还有另外一种</p> <p>在对于notification、弹层等这种通知组件，我们希望使用更加另外灵活，类似于window.alert这样调用，并不想每次使用都需要注册components, 我们可以使用 Vue.extend 构造器来创建组件，把它封装为单独的vue插件，在任何vue项目中都能use使用，也能发布为单独的npm包</p> <p>本文也算是对notification组件的原理分析</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
  <span class="token keyword">import</span> Component <span class="token keyword">from</span> <span class="token string">'./func-notification'</span>

  <span class="token comment">//返回一个扩展实例构造器</span>
  <span class="token keyword">const</span> NotificationConstructor <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>Component<span class="token punctuation">)</span>
  <span class="token keyword">export</span> NotificationConstructor
</code></pre></div><p>因为没有gif图，先看看静态图组件完成后的效果。组件是采用调用方法开控制调用和隐藏的，出现两秒钟后自动消失，连续多次调用方法，组件会层叠堆加</p> <p><strong>组件的使用方式</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//Notification里面需要暴露install方法，才能使用use</span>
  Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Notification<span class="token punctuation">)</span>

<span class="token comment">//在任意组件中使用</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$notify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        content<span class="token punctuation">:</span> <span class="token string">'test $notify'</span><span class="token punctuation">,</span>
        btn<span class="token punctuation">:</span> <span class="token string">'close'</span><span class="token punctuation">,</span>
        autoClose<span class="token punctuation">:</span><span class="token number">2000</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>展示</strong> <img src="https://upload-images.jianshu.io/upload_images/12380377-04965672cac9dd47.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="10.png"></p> <h2 id="目录结构"><a href="#目录结构" aria-hidden="true" class="header-anchor">#</a> 目录结构</h2> <ul><li>notification.vue           模版文件，里面用来写html和css</li> <li>func-notification.js               使用vue的extends选项将notification.vue组件扩充</li> <li>function                            组件实例函数，向外部导出构造方法</li> <li>index.js                  注册组件，挂载组件</li></ul> <p><img src="https://upload-images.jianshu.io/upload_images/12380377-4921e02c42ef7ec6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="8.png"></p> <h4 id="notification-vue-（模版组件）"><a href="#notification-vue-（模版组件）" aria-hidden="true" class="header-anchor">#</a> notification.vue （模版组件）</h4> <p>实现布局与样式，同时监听了点击事件，和动画结束钩子，分别向外派发了组件关闭和组件销毁emit，以及在鼠标移入时创建定时器，移除时销毁定时器</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>transition name<span class="token operator">=</span><span class="token string">&quot;fade&quot;</span> @after<span class="token operator">-</span>leave<span class="token operator">=</span><span class="token string">&quot;afterLeave&quot;</span> @after<span class="token operator">-</span>enter<span class="token operator">=</span><span class="token string">&quot;afterEnter&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div
      <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;notification&quot;</span>
      <span class="token punctuation">:</span>style<span class="token operator">=</span><span class="token string">&quot;style&quot;</span>
      v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">&quot;visible&quot;</span>
      @mouseenter<span class="token operator">=</span><span class="token string">&quot;clearTimer&quot;</span>
      @mouseleave<span class="token operator">=</span><span class="token string">&quot;createTimer&quot;</span>
    <span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;content&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>content<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn&quot;</span> @click<span class="token operator">=</span><span class="token string">&quot;handleClose&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>btn<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>transition<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Notification'</span><span class="token punctuation">,</span>
  props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    content<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
      required<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    btn<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">'关闭'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      visible<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">style</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">handleClose</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">afterLeave</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'closed'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">afterEnter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">clearTimer</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">createTimer</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style lang<span class="token operator">=</span><span class="token string">&quot;stylus&quot;</span> scoped<span class="token operator">&gt;</span>
<span class="token punctuation">.</span>notification
  display<span class="token punctuation">:</span> inline<span class="token operator">-</span>flex
  background<span class="token operator">-</span>color #<span class="token number">303030</span>
  color <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  align<span class="token operator">-</span>items center
  padding <span class="token number">20</span>px
  min<span class="token operator">-</span>width <span class="token number">280</span>px
  box<span class="token operator">-</span>shadow <span class="token number">0</span>px <span class="token number">3</span>px <span class="token number">5</span>px <span class="token operator">-</span><span class="token number">1</span>px <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  <span class="token number">0</span>px <span class="token number">6</span>px <span class="token number">10</span>px <span class="token number">0</span>px <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.14</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  <span class="token number">0</span>px <span class="token number">1</span>px <span class="token number">18</span>px <span class="token number">0</span>px <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.12</span><span class="token punctuation">)</span>
  flex<span class="token operator">-</span>wrap wrap
  transition all <span class="token number">.3</span>s
<span class="token punctuation">.</span>content
  padding <span class="token number">0</span>
<span class="token punctuation">.</span>btn
  color #ff4081
  padding<span class="token operator">-</span>left <span class="token number">24</span>px
  margin<span class="token operator">-</span>left auto
  cursor pointer
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
</code></pre></div><h2 id="func-notification-js-单独实现业务"><a href="#func-notification-js-单独实现业务" aria-hidden="true" class="header-anchor">#</a> func-notification.js (单独实现业务)</h2> <p>extends继承组件，单独实现其业务逻辑，根据组件实例上的<code>verticalOffset</code>设置计算属性求得组件的bottom定位，</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Notification <span class="token keyword">from</span> <span class="token string">'./notification.vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">//继承模版的所有选项，重写</span>
  <span class="token keyword">extends</span><span class="token punctuation">:</span> Notification<span class="token punctuation">,</span>
  <span class="token comment">//用于动态给到bottom定位</span>
  computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">style</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        position<span class="token punctuation">:</span> <span class="token string">'fixed'</span><span class="token punctuation">,</span>
        right<span class="token punctuation">:</span> <span class="token string">'20px'</span><span class="token punctuation">,</span>
        bottom<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>verticalOffset<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px`</span></span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//用于开始计算倒计时</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">createTimer</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//autoClose值在props里面已经传进来了</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>autoClose<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>autoClose<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">clearTimer</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">afterEnter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">.</span>offsetHeight
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeDestory</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//组件销毁之前清除定时器</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clearTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      verticalOffset<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      autoClose<span class="token punctuation">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
      height<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      visible<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="function-js-管理实例"><a href="#function-js-管理实例" aria-hidden="true" class="header-anchor">#</a> function.js (管理实例)</h2> <p>向外导出一个notify方法，使用Vue.extend(Component)返回构造器，每次调用notify方法都会创建新的notification实例，用数组保存实例</p> <p>监听每一个实例的关闭和销毁事件,以及实现移除实例的方法，改变实例上的verticalOffset高度来控制多个实例组件淡出动画</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Component <span class="token keyword">from</span> <span class="token string">'./func-notification'</span>

<span class="token comment">//返回一个扩展实例构造器</span>
<span class="token keyword">const</span> NotificationConstructor <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>Component<span class="token punctuation">)</span>
<span class="token keyword">const</span> instances <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> seed <span class="token operator">=</span> <span class="token number">1</span>

<span class="token keyword">const</span> <span class="token function-variable function">removeInstance</span> <span class="token operator">=</span> <span class="token punctuation">(</span>instance<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token keyword">const</span> len <span class="token operator">=</span> instances<span class="token punctuation">.</span>length
    <span class="token comment">//findIndex() 方法   为数组中的每个元素都调用一次函数执行     instances为实例数组</span>
  <span class="token keyword">const</span> index <span class="token operator">=</span> instances<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span>inst <span class="token operator">=&gt;</span> instance<span class="token punctuation">.</span>id <span class="token operator">===</span> inst<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
  instances<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
<span class="token comment">//拿到组件的高低 ，vm就是dom</span>
  <span class="token keyword">const</span> removeHeight <span class="token operator">=</span> instance<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>height 
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> index<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    instances<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>verticalOffset <span class="token operator">=</span>
<span class="token comment">//组件的verticalOffset高度 - 自身高度- 下边的间距</span>
      <span class="token function">parseInt</span><span class="token punctuation">(</span>instances<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>verticalOffset<span class="token punctuation">)</span> <span class="token operator">-</span> removeHeight <span class="token operator">-</span> <span class="token number">16</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">notify</span> <span class="token operator">=</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    autoClose<span class="token punctuation">,</span>
    <span class="token operator">...</span>rest
  <span class="token punctuation">}</span> <span class="token operator">=</span> options

  <span class="token comment">//使用propsData  为组件传递props</span>
  <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NotificationConstructor</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    propsData<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>rest
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      autoClose<span class="token punctuation">:</span> autoClose <span class="token operator">===</span> undefined <span class="token operator">?</span> <span class="token number">3000</span> <span class="token punctuation">:</span> autoClose
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">//每次调用函数 id+1</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token template-string"><span class="token string">`notification_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>seed<span class="token operator">++</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
  instance<span class="token punctuation">.</span>id <span class="token operator">=</span> id
  <span class="token comment">//生成dom节点并且挂载到body下</span>
  instance<span class="token punctuation">.</span>vm <span class="token operator">=</span> instance<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$el<span class="token punctuation">)</span>

  <span class="token comment">//设置值为显示dom</span>
  instance<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token keyword">let</span> verticalOffset <span class="token operator">=</span> <span class="token number">0</span>

  <span class="token comment">//在每个实例上挂在这里的元素高度           第一个实例高度为0</span>
  instances<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// offsetHeight 它返回该元素的像素高度     </span>
    verticalOffset <span class="token operator">+=</span> item<span class="token punctuation">.</span>$el<span class="token punctuation">.</span>offsetHeight <span class="token operator">+</span> <span class="token number">16</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token comment">//首个和最后一个下边框留16个像素</span>
  verticalOffset <span class="token operator">+=</span> <span class="token number">16</span>
  instance<span class="token punctuation">.</span>verticalOffset <span class="token operator">=</span> verticalOffset
  instances<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span>
  <span class="token comment">//监听销毁组件关闭事件</span>
  instance<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'closed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">removeInstance</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span>
  <span class="token comment">//移除dom</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$el<span class="token punctuation">)</span>
    <span class="token comment">//销毁组件</span>
    instance<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">//监听关闭组件事件</span>
  instance<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    instance<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> instance<span class="token punctuation">.</span>vm
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> notify

</code></pre></div><h2 id="index-js-该模块的接口文件"><a href="#index-js-该模块的接口文件" aria-hidden="true" class="header-anchor">#</a> index.js(该模块的接口文件)</h2> <p>导出组件，挂载在vue实例上</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Notification <span class="token keyword">from</span> <span class="token string">'./notification.vue'</span>
<span class="token keyword">import</span> notify <span class="token keyword">from</span> <span class="token string">'./function'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>Notification<span class="token punctuation">.</span>name<span class="token punctuation">,</span> Notification<span class="token punctuation">)</span>
  Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$notify <span class="token operator">=</span> notify
<span class="token punctuation">}</span>
</code></pre></div><h2 id="使用"><a href="#使用" aria-hidden="true" class="header-anchor">#</a> 使用</h2> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">//main.js中注册组件</span>
   Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Notification<span class="token punctuation">)</span>

<span class="token comment">//在任意组件中使用</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$notify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        content<span class="token punctuation">:</span> <span class="token string">'test $notify'</span><span class="token punctuation">,</span>
        btn<span class="token punctuation">:</span> <span class="token string">'close'</span><span class="token punctuation">,</span>
        autoClose<span class="token punctuation">:</span><span class="token number">2000</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/vue/datePicker/" class="prev">
          dataPicker实现(日期选择组件)
        </a></span> <span class="next"><a href="/blog/javascript/Promise/">
          动手实现一个Promise
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/blog/assets/js/app.1a49a42b.js" defer></script><script src="/blog/assets/js/12.15a468c8.js" defer></script>
  </body>
</html>
